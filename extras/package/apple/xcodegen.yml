name: VLC
options:
  bundleIdPrefix: org.videolan.vlc
  deploymentTarget:
    iOS: 9.0
  StripBitcodeFromCopiedFiles: NO
configs:
  Debug: debug
  Release: release
  Debug-bitcode: debug
targets:
  VLCAutomake:
    type: ""
    platform: ${VLC_PLATFORM}
    legacy:
      toolPath: ${VLC_BUILD_DIR}/compile
      passSettings: false
      attributes: -C ${VLC_BUILD_DIR}
      workingDirectory: ${VLC_BUILD_DIR}
    sources:
      - path: "${VLC_SRC_DIR}/src"
        excludes: "**/Makefile.in"
      - path: "${VLC_SRC_DIR}/include"
        excludes: "**/Makefile.in"
      - path: "${VLC_SRC_DIR}/modules"
        excludes: "**/Makefile.in"

  vlccoreios:
    type: "application"
    platform: ${VLC_PLATFORM}
    dependencies:
      - target: VLCAutomake
    info:
      path: "vlccoreios/Info.plist"
    sources:
      - path: ${VLC_BUILD_DIR}/test/vlccoreios
        type: file
        optional: true
        attributes:
          - CodeSignOnCopy
        buildPhase:
          copyFiles:
            destination: executables

  vlccoreiostuner:
    type: "application"
    platform: ${VLC_PLATFORM}
    dependencies:
      - target: VLCAutomake
    info:
      path: "vlccoreiostuner/Info.plist"
    sources:
      - path: ${VLC_BUILD_DIR}/test/vlccoreiostuner
        type: file
        optional: true
        attributes:
          - CodeSignOnCopy
        buildPhase:
          copyFiles:
            destination: executables

  vlc_static_modules:
    type: "library.static"
    platform: ${VLC_PLATFORM}
    dependencies:
      - target: VLCAutomake
    sources:
      - path: ${VLC_BUILD_DIR}/modules/.libs/libvlc_static_modules.a
        optional: true
        buildPhase:
          copyFiles:
            destination: productsDirectory

  vlc_plugin:
    type: "framework"
    platform: ${VLC_PLATFORM}
    dependencies:
      - target: VLCAutomake
    info:
      path: "vlc_plugin/Info.plist"
    settings:
      STRIP_BITCODE_FROM_COPIED_FILES: NO
    sources:
      - path: ${VLC_BUILD_DIR}/modules/.libs/libvlc_plugin.dylib
        optional: true
        attributes:
          - CodeSignOnCopy
        buildPhase:
          copyFiles:
            destination: productsDirectory
            subpath: vlc_plugin.framework/
    postBuildScripts:
      - name: Override vlc_plugin library
        script: |
                mv ${BUILT_PRODUCTS_DIR}/vlc_plugin.framework/libvlc_plugin.dylib \
                ${BUILT_PRODUCTS_DIR}/vlc_plugin.framework/vlc_plugin
                install_name_tool -id @rpath/vlc_plugin.framework/vlc_plugin \
                ${BUILT_PRODUCTS_DIR}/vlc_plugin.framework/vlc_plugin
                install_name_tool -change @rpath/libvlccore.dylib @rpath/vlccore.framework/vlccore \
                ${BUILT_PRODUCTS_DIR}/vlc_plugin.framework/vlc_plugin

  vlc:
    type: "library.static"
    platform: ${VLC_PLATFORM}
    dependencies:
      - target: VLCAutomake
    sources:
      - path: ${VLC_BUILD_DIR}/lib/.libs/libvlc.a
        optional: true
        buildPhase:
          copyFiles:
            destination: productsDirectory

  vlccore:
    type: "framework"
    platform: ${VLC_PLATFORM}
    dependencies:
      - target: VLCAutomake
    info:
      path: "vlccore/Info.plist"
    settings:
      STRIP_BITCODE_FROM_COPIED_FILES: NO
    sources:
      - path: ${VLC_BUILD_DIR}/src/.libs/libvlccore.dylib
        name: vlccore
        optional: true
        attributes:
          - CodeSignOnCopy
        buildPhase:
          copyFiles:
            destination: productsDirectory
            subpath: vlccore.framework/
      - path: ${VLC_SRC_DIR}/include/
        includes: "vlc_*.h"
        buildPhase: headers
        headerVisibility: public
    postBuildScripts:
      - name: Override vlccore library
        script: |
                mv ${BUILT_PRODUCTS_DIR}/vlccore.framework/libvlccore.dylib \
                ${BUILT_PRODUCTS_DIR}/vlccore.framework/vlccore
                install_name_tool -id @rpath/vlccore.framework/vlccore \
                ${BUILT_PRODUCTS_DIR}/vlccore.framework/vlccore
